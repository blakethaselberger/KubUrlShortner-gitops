apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: dev-url-shortener

namePrefix: dev-

labels:
- includeSelectors: true
  pairs:
    environment: dev

replicas:
- count: 1
  name: url-shortener

patches:
- path: deployment.yaml
  target:
    kind: Deployment
    name: url-shortener
- path: ingress.yaml
  target:
    kind: Ingress
    name: url-shortener

configMapGenerator:
- behavior: merge
  literals:
  - database_host=dev-postgres
  - redis_host=dev-redis
  - database_url="postgresql://user:password@dev-postgres:5432/urldb"
  name: url-shortener-config

# Lab 6.1 - Resource quotas for dev
resources:
- namespace.yaml
- ../../base
- resource-quota.yaml
images:
- name: analytics-worker
  newName: 211125541816.dkr.ecr.us-west-2.amazonaws.com/analytics-worker
  newTag: 78b6e5c8c5c590427400b767319cd4286299edce
- name: cleanup-worker
  newName: 211125541816.dkr.ecr.us-west-2.amazonaws.com/cleanup-worker
  newTag: 78b6e5c8c5c590427400b767319cd4286299edce
- name: migrations-worker
  newName: 211125541816.dkr.ecr.us-west-2.amazonaws.com/migrations-worker
  newTag: 78b6e5c8c5c590427400b767319cd4286299edce
- name: schema-init-worker
  newName: 211125541816.dkr.ecr.us-west-2.amazonaws.com/schema-init-worker
  newTag: 78b6e5c8c5c590427400b767319cd4286299edce
- name: url-shortener
  newName: 211125541816.dkr.ecr.us-west-2.amazonaws.com/url-shortener
  newTag: 78b6e5c8c5c590427400b767319cd4286299edce
- name: url-shortener-frontend
  newName: 211125541816.dkr.ecr.us-west-2.amazonaws.com/url-shortener-frontend
  newTag: 78b6e5c8c5c590427400b767319cd4286299edce
